<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>プログラムß</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            text-align: center;
            overflow-y: auto;
        }

        .scene {
            display: none;
        }

        .visible {
            display: block;
        }

        .button {
            margin: 20px;
            padding: 20px;
            background-color: #6fbced;
            border: none;
            font-size: 18px;
            color: white;
            cursor: pointer;
            border-radius: 10px;
        }

        .disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #stock-graph {
            background-color: #cce6ff;
            height: 200px;
            margin: 20px;
            width: 80%;
        }

        table {
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px;
            border: 1px solid #ccc;
            text-align: center;
        }

        .horse-track {
            width: 100%;
            height: 100px;
            background-color: #23ac31;
            border: 1px solid #ccc;
            position: relative;
            margin: 20px 0;
        }

        .horse-icon {
            width: 50px;
            height: 50px;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
        }

        #money-display {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 24px;
            background-color: #fff;
            padding: 5px 10px;
            border-radius: 10px;
        }

        input[type="number"], input[type="text"] {
            padding: 5px;
            font-size: 16px;
            margin: 5px;
        }

        #roulette {
            width: 400px;
            margin: 0 auto;
        }

        #roulette .act-start {
            display: block;
            margin-bottom: 40px;
            width: 70%;
            height: 1.8em;
            border-radius: 0.25em;
            padding: 20px;
            background-color: #6fbced;
            cursor: pointer;
            color: white;
        }

        #roulette .rltt {
            position: relative;
            width: 400px;
            height: 400px;
            border-radius: 50%;
            overflow: hidden;
            margin: 0 auto;
        }

        #roulette .segment {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-origin: center;
            clip-path: polygon(50% 50%, 100% 0%, 100% 100%);
        }

        #roulette .segment:nth-child(1) {
            background-color: yellow;
            transform: rotate(0deg);
        }

        #roulette .segment:nth-child(2),
        #roulette .segment:nth-child(3),
        #roulette .segment:nth-child(4) {
            background-color: blue;
            transform: rotate(60deg);
        }

        #roulette .segment:nth-child(5),
        #roulette .segment:nth-child(6),
        #roulette .segment:nth-child(7),
        #roulette .segment:nth-child(8),
        #roulette .segment:nth-child(9) {
            background-color: red;
            transform: rotate(120deg);
        }

        .roulette-container {
            position: relative;
        }

        .pointer {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 20px solid black;
        }

        #debugger {
            margin: 20px 0;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <h3>made by kiku-kick</h3>
</head>
<body>

    <!-- 所持金表示 -->
    <div id="money-display">所持金: <span id="current-money">0</span> 円</div>

    <!-- メインメニュー -->
    <div id="main-menu" class="scene visible">
        <h1>所持金: <span id="current-money-main">0</span> 円</h1>
        <h3>ゲームメニュー</h3>
        <button class="button" id="go-horse-race">競馬場に向かう</button>
        <button class="button" id="go-investment">投資</button>
        <button class="button" id="go-settings">設定</button>
        <button class="button" id="claim-daily-reward">デイリー報酬を受け取る</button>
    </div>

    <!-- 設定画面 -->
    <div id="settings" class="scene">
        <h1>設定</h1>
        <input type="text" id="debugger" placeholder="デバッグコード入力">
        <button class="button" id="nan-to-money">NaNを1000コイン返還</button>
        <button class="button" id="back-settings">メインメニューに戻る</button>
    </div>

    <!-- 投資画面 -->
    <div id="investment" class="scene">
        <h1>投資</h1>
        <canvas id="stock-graph"></canvas>
        <table>
            <thead>
                <tr>
                    <th>銘柄</th>
                    <th>株価</th>
                    <th>保有株数</th>
                    <th>平均購入価格</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>株A</td>
                    <td><span id="stockA-price">0</span> 円</td>
                    <td><span id="owned-stocksA">0</span> 株</td>
                    <td><span id="average-stockA-price">0</span> 円</td>
                </tr>
                <tr>
                    <td>株B</td>
                    <td><span id="stockB-price">0</span> 円</td>
                    <td><span id="owned-stocksB">0</span> 株</td>
                    <td><span id="average-stockB-price">0</span> 円</td>
                </tr>
                <tr>
                    <td>株C</td>
                    <td><span id="stockC-price">0</span> 円</td>
                    <td><span id="owned-stocksC">0</span> 株</td>
                    <td><span id="average-stockC-price">0</span> 円</td>
                </tr>
            </tbody>
        </table>
        <input type="number" id="stock-amount" placeholder="株数を入力" min="1">
        <select id="stock-type">
            <option value="stockA">株A</option>
            <option value="stockB">株B</option>
            <option value="stockC">株C</option>
        </select>
        <button class="button" id="buy-stock">株を買う</button>
        <button class="button" id="sell-stock">株を売る</button>
        <p id="stock-status"></p>
        <button class="button" id="clear-investment-history">投資の履歴を全て消す</button>
        <button class="button" id="back-investment">メインメニューに戻る</button>
    </div>

    <!-- 競馬場 -->
    <div id="horse-racing" class="scene">
        <h1>競馬場</h1>
        <p>馬を選んで賭け金を入力してください</p>
        <div id="horse-list">
            <div class="horse">
                <input type="radio" name="horse" value="1" id="horse-1">
                <label for="horse-1">馬1 (オッズ: 2.0)</label>
            </div>
            <div class="horse">
                <input type="radio" name="horse" value="2" id="horse-2">
                <label for="horse-2">馬2 (オッズ: 3.0)</label>
            </div>
            <div class="horse">
                <input type="radio" name="horse" value="3" id="horse-3">
                <label for="horse-3">馬3 (オッズ: 5.0)</label>
            </div>
            <div class="horse">
                <input type="radio" name="horse" value="4" id="horse-4">
                <label for="horse-4">馬4 (オッズ: 10.0)</label>
            </div>
            <div class="horse">
                <input type="radio" name="horse" value="5" id="horse-5">
                <label for="horse-5">馬5 (オッズ: 20.0)</label>
            </div>
        </div>
        <input type="number" id="bet-amount" placeholder="賭け金を入力" min="1">
        <button class="button" id="start-race">レースを開始する</button>
        <div id="race-track">
            <div class="horse-track" id="track-1"><img src="horse.png" class="horse-icon" id="icon-1"></div>
            <div class="horse-track" id="track-2"><img src="horse.png" class="horse-icon" id="icon-2"></div>
            <div class="horse-track" id="track-3"><img src="horse.png" class="horse-icon" id="icon-3"></div>
            <div class="horse-track" id="track-4"><img src="horse.png" class="horse-icon" id="icon-4"></div>
            <div class="horse-track" id="track-5"><img src="horse.png" class="horse-icon" id="icon-5"></div>
        </div>
        <p id="race-result"></p>
        <button class="button" id="back-horse">メインメニューに戻る</button>
    </div>

    <!-- ルーレット -->
 <div id="roulette" class="scene">
    <h1>ルーレット</h1>
    <input type="number" id="roulette-bet" placeholder="賭け金を入力" min="1">

    <!-- ルーレットコンテナ -->
    <div class="roulette-container">
        <div class="rltt" id="roulette-wheel">
            <!-- 赤色: 10倍 -->
            <div class="segment red" data-multiplier="10"></div>
            <div class="segment blue" data-multiplier="2"></div>
            <div class="segment yellow" data-multiplier="5"></div>
            <div class="segment white" data-multiplier="-2"></div>
            <div class="segment blue" data-multiplier="2"></div>
            <div class="segment red" data-multiplier="10"></div>
            <div class="segment white" data-multiplier="-2"></div>
            <div class="segment yellow" data-multiplier="5"></div>
            <div class="segment blue" data-multiplier="2"></div>
            <div class="segment red" data-multiplier="10"></div>
            <div class="segment white" data-multiplier="-2"></div>
        </div>
        <div class="pointer"></div>
    </div>

    <!-- スタート＆ストップボタン -->
    <button class="button" id="start-roulette">ルーレットを回す</button>
    <button class="button" id="stop-roulette" disabled>ストップ</button>

    <p id="roulette-result"></p>
    <button class="button" id="back-roulette">メインメニューに戻る</button>
</div>


    <!-- スロットマシン -->
    <div id="slot-machine" class="scene">
        <h1>スロットマシン</h1>
        <input type="number" id="slot-bet" placeholder="賭け金を入力" min="1">
        <button class="button" id="spin-slot">スロットを回す</button>
        <p id="slot-result"></p>
        <button class="button" id="back-slot">メインメニューに戻る</button>
    </div>

    <script>
        let money = localStorage.getItem('money') ? parseInt(localStorage.getItem('money')) : 1000;
        document.getElementById('current-money').textContent = money;
        document.getElementById('current-money-main').textContent = money;

        function updateMoney(amount) {
            money += amount;
            document.getElementById('current-money').textContent = money;
            document.getElementById('current-money-main').textContent = money;
            localStorage.setItem('money', money);
        }

        // デイリー報酬機能
        document.getElementById('claim-daily-reward').addEventListener('click', () => {
            const lastClaim = localStorage.getItem('lastDailyReward');
            const now = new Date();
            if (lastClaim) {
                const lastDate = new Date(lastClaim);
                const diff = now - lastDate;
                const oneDay = 24 * 60 * 60 * 1000;
                if (diff < oneDay) {
                    alert("デイリー報酬は1日1回のみです。");
                    return;
                }
            }
            updateMoney(500); // デイリー報酬額
            localStorage.setItem('lastDailyReward', now);
            alert("500円のデイリー報酬を受け取りました！");
        });

        // NaNを1000コイン返還
        document.getElementById('nan-to-money').addEventListener('click', () => {
            if (isNaN(money)) {
                money = 1000;
                document.getElementById('current-money').textContent = money;
                localStorage.setItem('money', money);
                alert("NaNを1000コインに修正しました。");
            }
        });

        // 保有株数の管理
        let ownedStocks = {
            stockA: { amount: 0, totalSpent: 0 },
            stockB: { amount: 0, totalSpent: 0 },
            stockC: { amount: 0, totalSpent: 0 }
        };

        let stockPrices = {
            stockA: [100],
            stockB: [200],
            stockC: [300]
        };

        const stockChart = new Chart(document.getElementById('stock-graph'), {
            type: 'line',
            data: {
                labels: Array.from({ length: stockPrices.stockA.length }, (_, i) => `${i * 10}s`),
                datasets: [
                    { label: '株A', data: stockPrices.stockA, borderColor: 'rgba(75, 192, 192, 1)', borderWidth: 2 },
                    { label: '株B', data: stockPrices.stockB, borderColor: 'rgba(255, 159, 64, 1)', borderWidth: 2 },
                    { label: '株C', data: stockPrices.stockC, borderColor: 'rgba(153, 102, 255, 1)', borderWidth: 2 }
                ]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        function updateStockPrice() {
            Object.keys(stockPrices).forEach(stock => {
                const lastPrice = stockPrices[stock][stockPrices[stock].length - 1];
                const newPrice = Math.max(10, Math.floor(lastPrice + (Math.random() * 40 - 20)));
                stockPrices[stock].push(newPrice);
                if (stockPrices[stock].length > 100) {
                    stockPrices[stock].shift();
                }
            });
            stockChart.data.labels = Array.from({ length: stockPrices.stockA.length }, (_, i) => `${i * 10}s`);
            stockChart.data.datasets[0].data = stockPrices.stockA;
            stockChart.data.datasets[1].data = stockPrices.stockB;
            stockChart.data.datasets[2].data = stockPrices.stockC;
            stockChart.update();
            document.getElementById('stockA-price').textContent = stockPrices.stockA[stockPrices.stockA.length - 1];
            document.getElementById('stockB-price').textContent = stockPrices.stockB[stockPrices.stockB.length - 1];
            document.getElementById('stockC-price').textContent = stockPrices.stockC[stockPrices.stockC.length - 1];
        }

        setInterval(updateStockPrice, 20000);
        updateStockPrice();

        function updateAverageStockPrice(stock) {
            const stockData = ownedStocks[stock];
            const averagePrice = stockData.amount > 0 ? stockData.totalSpent / stockData.amount : 0;
            document.getElementById(`average-${stock}-price`).textContent = Math.floor(averagePrice);
        }

        function updateOwnedStocksDisplay(stock) {
            document.getElementById(`owned-stocks${stock.toUpperCase()}`).textContent = ownedStocks[stock].amount;
        }

        document.getElementById('buy-stock').addEventListener('click', () => {
            const stockAmount = parseInt(document.getElementById('stock-amount').value);
            const stockType = document.getElementById('stock-type').value;
            const stockPrice = stockPrices[stockType][stockPrices[stockType].length - 1];
            if (isNaN(stockAmount) || stockAmount <= 0) {
                alert('購入する株数を正しく入力してください。');
                return;
            }
            const totalCost = stockPrice * stockAmount;
            if (totalCost > money) {
                alert(`所持金が不足しています。必要な金額: ${totalCost}円`);
                return;
            }
            ownedStocks[stockType].amount += stockAmount;
            ownedStocks[stockType].totalSpent += totalCost;
            updateMoney(-totalCost);
            updateAverageStockPrice(stockType);
            updateOwnedStocksDisplay(stockType);
            document.getElementById('stock-status').textContent = `${stockType}株価: ${stockPrice}円で${stockAmount}株購入しました。`;
            localStorage.setItem('ownedStocks', JSON.stringify(ownedStocks));
        });

        document.getElementById('sell-stock').addEventListener('click', () => {
            const stockAmount = parseInt(document.getElementById('stock-amount').value);
            const stockType = document.getElementById('stock-type').value;
            const stockPrice = stockPrices[stockType][stockPrices[stockType].length - 1];
            if (isNaN(stockAmount) || stockAmount <= 0) {
                alert('売却する株数を正しく入力してください。');
                return;
            }
            if (stockAmount > ownedStocks[stockType].amount) {
                alert(`${stockType}の保有株数が不足しています。現在の保有株数: ${ownedStocks[stockType].amount}株`);
                return;
            }
            const totalGain = stockPrice * stockAmount;
            ownedStocks[stockType].amount -= stockAmount;
            updateMoney(totalGain);
            updateAverageStockPrice(stockType);
            updateOwnedStocksDisplay(stockType);
            document.getElementById('stock-status').textContent = `${stockType}株価: ${stockPrice}円で${stockAmount}株売却しました。`;
            localStorage.setItem('ownedStocks', JSON.stringify(ownedStocks));
        });

        document.getElementById('clear-investment-history').addEventListener('click', () => {
            localStorage.removeItem('ownedStocks');
            ownedStocks = {
                stockA: { amount: 0, totalSpent: 0 },
                stockB: { amount: 0, totalSpent: 0 },
                stockC: { amount: 0, totalSpent: 0 }
            };
            stockPrices = { stockA: [100], stockB: [200], stockC: [300] };
            updateOwnedStocksDisplay('stockA');
            updateOwnedStocksDisplay('stockB');
            updateOwnedStocksDisplay('stockC');
            updateAverageStockPrice('stockA');
            updateAverageStockPrice('stockB');
            updateAverageStockPrice('stockC');
            document.getElementById('stock-status').textContent = '投資の履歴をすべて削除しました。';
        });

        const scenes = {
            mainMenu: document.getElementById('main-menu'),
            investment: document.getElementById('investment'),
            horseRacing: document.getElementById('horse-racing'),
            roulette: document.getElementById('roulette'),
            slotMachine: document.getElementById('slot-machine'),
            settings: document.getElementById('settings')
        };

        function switchScene(toShow) {
            Object.values(scenes).forEach(scene => scene.classList.remove('visible'));
            toShow.classList.add('visible');
        }

        document.getElementById('go-horse-race').addEventListener('click', () => switchScene(scenes.horseRacing));
        document.getElementById('go-roulette').addEventListener('click', () => switchScene(scenes.roulette));
        document.getElementById('go-slot').addEventListener('click', () => switchScene(scenes.slotMachine));
        document.getElementById('go-investment').addEventListener('click', () => {
            switchScene(scenes.investment);
            updateOwnedStocksDisplay('stockA');
            updateOwnedStocksDisplay('stockB');
            updateOwnedStocksDisplay('stockC');
        });

        document.getElementById('go-settings').addEventListener('click', () => switchScene(scenes.settings));
        document.getElementById('back-settings').addEventListener('click', () => switchScene(scenes.mainMenu));

        document.getElementById('back-horse').addEventListener('click', () => switchScene(scenes.mainMenu));
        document.getElementById('back-roulette').addEventListener('click', () => switchScene(scenes.mainMenu));
        document.getElementById('back-slot').addEventListener('click', () => switchScene(scenes.mainMenu));
        document.getElementById('back-investment').addEventListener('click', () => switchScene(scenes.mainMenu));

        const horseOdds = [2.0, 3.0, 5.0, 10.0, 20.0];
        let raceRunning = false;

        document.getElementById('start-race').addEventListener('click', () => {
            if (raceRunning) return;
            const selectedHorse = document.querySelector('input[name="horse"]:checked');
            const betAmount = parseInt(document.getElementById('bet-amount').value);
            if (selectedHorse && betAmount > 0) {
                const horseIndex = parseInt(selectedHorse.value) - 1;
                if (betAmount > money) {
                    alert(`所持金が不足しています。必要な金額: ${betAmount}円`);
                    return;
                }
                let positions = [0, 0, 0, 0, 0];
                raceRunning = true;
                const raceInterval = setInterval(() => {
                    let winner = null;
                    positions.forEach((pos, index) => {
                        pos += Math.random() * 5;
                        positions[index] = pos;
                        document.getElementById(`icon-${index + 1}`).style.left = `${pos}%`;
                        if (pos >= 100 && !winner) winner = index;
                    });

                    if (winner !== null) {
                        clearInterval(raceInterval);
                        document.getElementById('race-result').textContent = (winner === horseIndex) ?
                            `あなたの馬が勝ちました！${betAmount * horseOdds[horseIndex]}円獲得！` :
                            `残念！馬${winner + 1}が勝ちました！`;
                        updateMoney(winner === horseIndex ? betAmount * horseOdds[horseIndex] : -betAmount);
                        raceRunning = false;
                    }
                }, 100);
            } else {
                alert('正しい馬と賭け金を選んでください！');
            }
        });
// ルーレット変数
let isSpinning = false;
let currentRotation = 0;
let spinInterval;

document.getElementById('start-roulette').addEventListener('click', () => {
    const betAmount = parseInt(document.getElementById('roulette-bet').value);

    if (isNaN(betAmount) || betAmount <= 0) {
        alert('賭け金を入力してください');
        return;
    }

    document.getElementById('start-roulette').disabled = true;
    document.getElementById('stop-roulette').disabled = false;

    // ルーレットを回転させる
    isSpinning = true;
    spinInterval = setInterval(() => {
        currentRotation += 75; // 回転速度
        document.getElementById('roulette-wheel').style.transform = `rotate(${currentRotation}deg)`;
    }, 100);
});

// ストップボタン処理
document.getElementById('stop-roulette').addEventListener('click', () => {
    clearInterval(spinInterval);
    document.getElementById('start-roulette').disabled = false;
    document.getElementById('stop-roulette').disabled = true;

    // ランダムな停止位置を計算
    const randomAngle = (currentRotation % 360) + Math.random() * 360;
    const selectedSegment = Math.floor((randomAngle % 360) / 30); // 各セグメントの角度
    const segments = document.querySelectorAll('.segment');
    const selectedMultiplier = segments[selectedSegment].getAttribute('data-multiplier');

    // 結果処理
    const betAmount = parseInt(document.getElementById('roulette-bet').value);
    let resultMessage;
    if (selectedMultiplier > 0) {
        const winnings = betAmount * selectedMultiplier;
        resultMessage = `結果: ${winnings}円獲得！`;
        updateMoney(winnings);
    } else {
        const loss = betAmount * Math.abs(selectedMultiplier);
        resultMessage = `ハズレ！-${loss}円失いました。`;
        updateMoney(-loss);
    }
    document.getElementById('roulette-result').textContent = resultMessage;
});

        // デバッグコード入力
        document.getElementById('debugger').addEventListener('input', (e) => {
            if (e.target.value === '12345') {
                updateMoney(10000);
                e.target.value = '';
            }
        });

        updateAverageStockPrice('stockA');
        updateAverageStockPrice('stockB');
        updateAverageStockPrice('stockC');
        updateOwnedStocksDisplay('stockA');
        updateOwnedStocksDisplay('stockB');
        updateOwnedStocksDisplay('stockC');
    </script>
</body>
</html>
